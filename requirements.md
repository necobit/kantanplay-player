# Kantan Play MIDIプレイヤー 要件定義

## 概要

- ブラウザ上で動作するWebアプリケーション。
- ユーザーが画面上で数字（1〜7）を入力し、そのシーケンスをMIDI（BLE MIDI対応）経由でKantan Play（MIDI機器）へ送信・演奏する。

## 機能要件

### 1. MIDI送信機能
- Web MIDI APIおよびWeb Bluetooth MIDI（BLE MIDI）を利用し、MIDI機器と接続可能。
- 送信MIDIチャンネルは1固定。
- 入力数字（1〜7）を下記対応表に従いMIDIノート番号へ変換して送信。

| 入力数字 | MIDIノート番号 |
|----------|---------------|
| 1        | 60            |
| 2        | 62            |
| 3        | 64            |
| 4        | 65            |
| 5        | 67            |
| 6        | 69            |
| 7        | 71            |

- ノートオン・ノートオフをセットで送信。ノートオンからノートオフまでの長さは「1ステップの長さの半分」。

### 2. シーケンス入力・編集
- 画面上に等間隔でステップ（時間軸：横方向）を配置。
- 1パートのみ入力可能。
- カーソル操作で任意のステップに移動し、数字キーで入力。入力後は自動で次のステップにカーソルが移動。
- ステップは先頭から詰めて配置される（空きステップはなし）。

### 3. シーケンス設定
- 全体設定として下記3項目をユーザーが入力・変更可能（デフォルト値：BPM=120、倍数=1、繰り返し回数=1）。
    - BPM：1分間を何ステップに分解するか（例：BPM120 → 1ステップ=500ms）
    - 倍数：BPMにかける倍率（例：BPM120×2=240）
    - 繰り返し回数：入力された数字列を何回繰り返すか

### 4. シーケンス再生
- 「再生」ボタン：先頭またはカーソル位置から演奏開始。
- 「停止」ボタン：演奏停止。
- 再生中もシーケンス編集可能。
- 演奏データは「（数字列×繰り返し回数）をBPM・倍数設定でタイミング計算し、MIDIノートオン・オフとして送信」する。

#### 例
- BPM=120, 倍数=1, 繰り返し回数=2, 入力=1 2 3
- 1ステップ=500ms、ノートオン250ms→ノートオフ250ms
- 送信順：「Note on 60, Note off 60, Note on 60, Note off 60, Note on 62, Note off 62, Note on 62, Note off 62, Note on 64, Note off 64, Note on 64, Note off 64」

## 非機能要件

- モダンなUI/UX（レスポンシブ対応推奨）。
- Web MIDI API/ BLE MIDI対応ブラウザ（例：Chrome）で動作。
- 入力・再生・停止等の操作は直感的に行えること。

## 画面要件

- シーケンス入力エリア（ステップ表示、カーソル表示、数字入力）
- 再生・停止ボタン
- BPM、倍数、繰り返し回数の入力フィールド
- MIDI接続状態表示

## その他

- 既存の同名・類似機能、APIエンドポイント、共通処理がないか実装前に必ず確認すること。
- 命名規則・ディレクトリ構造の一貫性を保つこと。

---
